#: import hex kivy.utils.get_color_from_hex
#: import CardTransition kivy.uix.screenmanager.CardTransition
#: import settings settings
#: import images images
<Runner>:
    # Handling the gesture event.
    on_left_to_right_line: manager.current = 'lists_screen';  manager.transition.direction = 'right'
    ScreenManagement:
        id: manager
        ListsScreen:
        EntriesScreen:
        SettingsScreen:

<ListsScreen>:
    name: 'lists_screen'
    md_bg_color: hex(settings.background_colour)
    on_pre_enter: root.refresh_lists()
    # on_pre_leave:
    # Main
    BoxLayout:
        orientation: 'vertical'
        #space_x: self.size[0]/3

        # Upper Panel
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 50
            size_hint: 1, 0.1

            Button:
                text: 'Settings'

                on_press:
                    root.manager.transition = CardTransition(direction='left', duration = 0.1)
                    root.manager.current = "settings_screen"
            Button:
                text: 'Edit'
            Button:
                text: 'Search'


        ScrollView:
            # Lists panel
            BoxLayout:
                id: lists_panel_id
                size_hint: 1, 0.8
                orientation: 'vertical'
                spacing: 1
                height: self.minimum_height
                size_hint_y: None
                padding: 10

        # Bottom panel
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: 50
            size_hint: 1, 0.1
            Button:
                text: 'Create new List'
                #font_size: settings.font_size
                on_press: root.open_list_popup(*args)

<EntriesScreen>:
    name: 'entries_screen'
    orientation: 'vertical'
    on_pre_enter:
        root.refresh_entries()
        self.ids.current_list_lbl.text = "<--  " + root.list_name
    # on_pre_leave: root.remove_all_entries()
    md_bg_color: hex(settings.background_colour)

    # Root
    BoxLayout:
        orientation: 'vertical'

        # Upper panel
        BoxLayout:
            id: entries_upper_panel_id
            orientation: 'horizontal'
            size_hint_y: None
            height: 50
            size_hint: 1, 0.1
            Button:
                id: current_list_lbl
                text: "<-  " + root.list_name
                size_hint: 0.6, 1
                on_press:
                    root.manager.transition = CardTransition(direction='right', duration = 0.1)
                    root.manager.current = "lists_screen"

            Button:
                text: 'Edit'
                size_hint: 0.2, 1
            Button:
                text: 'Tags'
                size_hint: 0.2, 1

        # Entries Panel
        ScrollView:
            StackLayout:
                #orientation: 'vertical'
                orientation:'rl-bt'
                spacing: 1
                size_hint: 1, 0.8
                id: entries_panel_id
                height: self.minimum_height
                size_hint_y: None
                pos_hint: {'top': 1}


        # Bottom Panel
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: 40
            size_hint: 1, 0.07
            TextInput:
                id: input_id
                #font_size: self.height - 15
                # hint_text_color: defaults  [0.5, 0.5, 0.5, 1.0] (grey).
                #valign: "middle"
                halign: "center"

                is_focusable: True
                hint_text: 'Add new entry'
                font_size: self.height - 15

                multiline: False
                write_tab: False
                on_text_validate:
                    root.create_entry(self.text)
                    self.text = ""



<SettingsScreen>:
    name: 'settings_screen'
    orientation: 'vertical'
    #space_x: self.size[0]/3
    md_bg_color: hex(settings.background_colour)

    # Root
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        Label:
            text: 'App version ' + settings.app_version
            #font_size: settings.font_size
        Button:
            text: 'Reset DB'
            on_press:
                root.reset_db()

        TextInput:
            halign: "center"
            valign: "middle"
            is_focusable: True
            hint_text: 'Add list name'
            multiline: False
            write_tab: False
            font_size: self.height - 15
            on_text_validate:
                root.delete_list_by_name(self.text)
                self.text = ""
        MDIconButton:
            icon: "images/back.png"
            #font_size: settings.font_size
            on_press:
                root.manager.transition = CardTransition(direction='right', duration = 0.1)
                root.manager.current = "lists_screen"

<CreateListPopup>:
    title: 'Create new List'
    id: create_list_popup_id
    on_open: app.root.popupreference=self
    size_hint: 1, 0.4
    auto_dismiss: True
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        TextInput:
            id: add_list_input_id
            halign: "center"
            valign: "middle"
            font_size: self.height - 15
            is_focusable: True
            height: "70dp"
            size_hint:(1, None)
            hint_text: 'List name'
            multiline: False
            write_tab: False
            on_text_validate:
                root.create_list(self.text)
                root.dismiss()
        Button:
            text: 'Back'
            height: "70dp"
            size_hint:(1, None)
            on_press:
                root.dismiss()

